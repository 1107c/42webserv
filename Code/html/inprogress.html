<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>42Webserv</title>
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div class="background-container">
            <nav class="authorize" id="login-signup">
                <a href="/signIn.html">로그인</a>
                |
                <a href="/signUp.html">회원가입</a>
            </nav>
			<div class="header" id="user-info" style="display:none;">
				<div class="profile">
					<img src="image/gyeongju.jpeg" alt="Profile Picture" id="profile-picture">
					<!-- <img src="/uploaded/aaa/download.jpeg" alt="Profile Picture" id="profile-picture"> -->
					<span class="profile-id" id="user-id"></span>
					<button class="logout-btn" id="logout-button">Logout</button>
				</div>
			</div>
            <h1 class="head-text">42Webserv</h1>
        </div>
        <h2 class="page-content">지역 소개</h2>
        <div class="squares-container">
            <div class="shape rounded-square">
                <div class="shape-title">지역 1</div>
            </div>
            <div class="shape rounded-square">
                <div class="shape-title">지역 2</div>
            </div>
            <div class="shape rounded-square">
                <div class="shape-title">지역 3</div>
            </div>
            <div class="shape rounded-square">
                <div class="shape-title">지역 4</div>
            </div>
            <div class="shape rounded-square">
                <div class="shape-title">지역 5</div>
            </div>
            <div class="shape rounded-square" data-href="/home.html">
                <div class="shape-title">지역 6</div>
            </div>
			<script>
				(async function() {
					setTimeout(async () => {
						try {
							const response = await fetch('/check-id', {
								method: 'GET'
							});
	
							data = await response.json();
							console.log("data: ", data);
							if (data.status == 'login') {
								document.getElementById('login-signup').style.display = 'none';
								document.getElementById('user-info').style.display = 'block';
								document.getElementById('user-id').textContent = data.id;
								const path = data.path ? data.path : ""
								if (path)
									document.getElementById("profile-picture").src = path;
							}
							else
							{
								document.getElementById('login-signup').style.display = 'block';
								document.getElementById('user-info').style.display = 'none';
							}
						} catch(error)
						{
							console.log(error);
							window.location.href = '/error';
						}
					}, 10)
				}());

				function deleteAllCookies() {
				    // 현재 도메인에 저장된 쿠키 목록 가져오기
				    const cookies = document.cookie.split(";");

				    // 각 쿠키 삭제
				    for (let cookie of cookies) {
				        const name = cookie.split("=")[0].trim(); // 쿠키 이름 추출

				        // 현재 경로(`/`)에서 삭제
				        document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;
				    }
				}
		
				document.getElementById('logout-button').addEventListener('click', async function(event) {
					event.preventDefault(); // 기본 GET 요청 방지

			        try {
		                const response = await fetch('/logout', {
		                    method: 'DELETE'
		                });

		                const result = await response.text();
						const data = JSON.parse(result).status;
		                if (data === "success") {
							window.location.href = '/';
						}
						else
							window.location.href = '/error';
		            } catch (error) {
						window.location.href = '/error';
		            }
			    });

                document.querySelectorAll('.shape').forEach(shape => {
                    shape.addEventListener('click', function(e) {
                        e.preventDefault();
                        const href = this.getAttribute('data-href');
                        
                        this.classList.add('expanding');
                        
                        setTimeout(() => {
                            window.location.href = href;
                        }, 500);
                    });
                });
            </script>
        </div>
    </body>
</html>